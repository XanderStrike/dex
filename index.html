<html>
  <head>
    <meta name="viewport"content="width=device-width,initial-scale=1">
    <title>Dex</title>
<style>
body {
  padding: 0;
  margin: 0;
  font-size: 20px;
  max-width: 100vw;
  overflow-x: hidden;
}
input {
  border: none;
  position: sticky;
  top: 0;
  width: 100%;
  font-size: 40px;
  padding: 0.125em;
}
.results {
  overflow-x: hidden;
}
.result-line {
  padding: 1em 0 1em 1em;
  border-top: solid;
}
.id {
  display: inline-block;
  width: 3em;
}

.banner {
  background-color: black;
  padding: 0.5em;
  color: white;
  margin-top: 1em;
}

.types {
  margin: 1em 0
}
.type-badge {
  padding: 0.25em;
  margin-bottom: 5em
}

.damage-row {
  display: block;
  width: 100%;
  padding: 0.25em 0;
}

.row-inner {
  padding: 0.25em;
}

.move-row {
  display: block;
  width: 100%;
  padding:0.25em 0;
}

.move-level {
  display: inline-block;
  width: 4em;

}

</style>
<link rel="stylesheet" href="colors.css">
<link rel="manifest" href="manifest.webmanifest">
  </head>
  <body>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/mustache@latest"></script>

    <input id="search" placeholder="search"></input>
    <div id="results">
      Loading...
    </div>

    <script id="result" type="x-tmpl-mustache">
      <div class="result-line {{ types }}">#<span class="id">{{ id }}</span><span class="name">{{ name }}</span></div>
    </script>

  <script>
var names;

$.getJSON( "/names.json", function( data ) {
  names = data;
  writeResults("");
});

$("#search").keyup(debounce(function() {
  var q = $("#search").val().toLowerCase();
  writeResults(q);
}, 100));

$("#search").focus( function() {
  $(this).val('');
});

function writeResults(q) {
  $("#results").empty();
  var template = $("#result").html();
  $.each( names, function( key, val ) {
    if (val['name'].includes(q)){
      $("#results").append(Mustache.render(template, val));
    }
  });
  hooks();
}

function hooks() {
  $(".result-line").click(function() {
    var id = $(this).find("span.id").html();
    var name = $(this).find("span.name").html();
    console.log(id);
    console.log(name);
    $("#search").val(name);
    fetch('pokemon/' + id + '.html')
    .then((response) => response.text())
    .then((template) => {
      document.getElementById('results').innerHTML = template;
      window.scrollTo(0,0);
    });
  });
}

//http://davidwalsh.name/javascript-debounce-function
function debounce(func, wait, immediate) {
    var timeout;
    return function() {
        var context = this, args = arguments;
        var later = function() {
            timeout = null;
            if (!immediate) func.apply(context, args);
        };
        var callNow = immediate && !timeout;
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
        if (callNow) func.apply(context, args);
    };
};
  </script>

  </body>
</html>
